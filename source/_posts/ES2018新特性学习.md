---
title: ES2018æ–°ç‰¹æ€§å­¦ä¹ 
date: 2018-07-02 19:47:59
categories: JavaScript
tags:
- ES2018
- ES9
---

ECMAScript 2018 (ES9) åœ¨ 6 æœˆåº•æ­£å¼å‘å¸ƒï¼Œå¸¦æ¥äº†å¾ˆå¤šæ–°ç‰¹æ€§ã€‚å…³äº ES7 å’Œ ES8 ç›¸å…³çš„çŸ¥è¯†ï¼Œå¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç«  [ES2016 å’Œ ES2017 å­¦ä¹ ](https://lz5z.com/ES2016%E5%92%8CES2017%E5%AD%A6%E4%B9%A0/)ã€‚ç›®å‰å¤§éƒ¨åˆ† ES7 å’Œ ES8 çš„ç‰¹æ€§éƒ½å¾—åˆ°ä¸»æµæµè§ˆå™¨çš„æ”¯æŒï¼Œè€Œ ES9 çš„æ–°ç‰¹æ€§è¿˜æœªèƒ½å®ç°å¾ˆå¥½çš„å…¼å®¹æ€§ã€‚

å…³äº ES7/8/9 å…¨éƒ¨ç‰¹æ€§å¯ä»¥æŸ¥çœ‹ tc39 å®˜æ–¹çš„ [proposals](https://github.com/tc39/proposals/blob/master/finished-proposals.md)ï¼Œè¿™äº›éƒ½æ˜¯æœ€åè¿›å…¥ stage 4 çš„ç‰¹æ€§ã€‚

ES9 çš„æ–°ç‰¹æ€§ï¼š

1. Lifting template literal restriction æ¨¡æ¿è¯­æ³•ä¿®æ­£
2. `s` (dotAll) flag for regular expressions (æ­£åˆ™è¡¨è¾¾å¼ dotAll æ¨¡å¼)
3. RegExp named capture groups (æ­£åˆ™è¡¨è¾¾å¼å‘½åæ•è·ç»„)
4. Rest/Spread Properties (Rest/Spread å±æ€§)
5. RegExp Lookbehind Assertions (æ­£åˆ™è¡¨è¾¾å¼åå‘(lookbehind)æ–­è¨€)
6. RegExp Unicode Property Escapes (æ­£åˆ™è¡¨è¾¾å¼ Unicode è½¬ä¹‰)
7. Promise.prototype.finally
8. Asynchronous Iteration (å¼‚æ­¥è¿­ä»£å™¨)

<!--more-->

## [æ­£åˆ™è¡¨è¾¾å¼ dotAll æ¨¡å¼](https://github.com/tc39/proposal-regexp-dotall-flag)

dotAll æ˜¯ä¸€ä¸ªæ–°çš„æ­£åˆ™è¡¨è¾¾å¼ä¿®é¥°ç¬¦ï¼Œç›®å‰ JS æ‹¥æœ‰çš„ä¿®é¥°ç¬¦æœ‰ï¼š

- g -> global
- i -> ingoreCase
- m -> multiline
- y -> sticky
- u -> unicode
- s -> dotAll

æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ `.` ç”¨æ¥åŒ¹é…ä»»ä½•å•ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯æœ‰ 2 ä¸ªé™¤å¤–ï¼šå¤šå­—èŠ‚ emoji å­—ç¬¦å’Œè¡Œç»ˆç»“ç¬¦ã€‚

```javascript
let regex = /^.$/
regex.test('ğŸ˜€')   // false
```

é€šè¿‡è®¾ç½® u è¡¨ç¤º unicode

```javascript
let regex = /^.$/u
regex.test('ğŸ˜€')   // true
```

è¡Œç»ˆæ­¢ç¬¦åŒ…æ‹¬

- U+000A LINE FEED (LF) (\n) - æ¢è¡Œ
- U+000D CARRIAGE RETURN (CR) (\r) - å›è½¦
- U+2028 LINE SEPARATOR - è¡Œåˆ†éš”ç¬¦
- U+2029 PARAGRAPH SEPARATOR - æ®µåˆ†éš”ç¬¦

è¿˜æœ‰ä¸€äº›å…¶å®ƒå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€è¡Œçš„å¼€å§‹ï¼š

- U+000B VERTICAL TAB (\v)
- U+000C FORM FEED (\f)
- U+0085 NEXT LINE

ç›®å‰ `.` åªèƒ½åŒ¹é…å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼š

```javascript
let regex = /./

regex.test('\n')       // false
regex.test('\r')       // false
regex.test('\u{2028}') // false
regex.test('\u{2029}') // false

regex.test('\v')       // true
regex.test('\f')       // true
regex.test('\u{0085}') // true
```

æ ‡è®° `s` è¡¨ç¤º dotAllï¼Œç”¨æ¥æ”¹å˜ `.` ä¸èƒ½åŒ¹é…è¡Œç»ˆæ­¢ç¬¦çš„è¡Œä¸º:

```javascript
/hello.world/.test('hello\nworld')  // false
/hello.world/s.test('hello\nworld') // true
```

æˆ–è€…ç”¨ `\s` æ¥åŒ¹é…ç©ºç™½ç¬¦ï¼š

```javascript
/hello.world/.test('hello\nworld')  // false
/hello[\s]world/s.test('hello\nworld') // true
```

dotAll è¡¨ç¤º `.` å¯ä»¥åŒ¹é…ä»»æ„å­—ç¬¦ï¼š

```javascript
const re = /hello.world/s  // ç­‰ä»·äº const re = new RegExp('hello.world', 's')

re.test('hello\nworld') // true
re.dotAll // true
re.flags // 's'
```

## [æ­£åˆ™è¡¨è¾¾å¼å‘½åæ•è·ç»„](https://github.com/tc39/proposal-regexp-named-groups)

æ•è·ç»„å°±æ˜¯æŠŠæ­£åˆ™è¡¨è¾¾å¼ä¸­åŒ¹é…åˆ°çš„å†…å®¹ï¼Œä¿å­˜åˆ°å†…å­˜ä¸­ä»¥æ•°å­—ç¼–å·æˆ–è€…æ˜¾å¼å‘½åçš„æ•°ç»„é‡Œï¼Œæ–¹ä¾¿åé¢ä½¿ç”¨ã€‚è¿™ç§å¼•ç”¨æ—¢å¯ä»¥åœ¨æ­£åˆ™è¡¨è¾¾å¼å†…éƒ¨ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨æ­£åˆ™è¡¨è¾¾å¼å¤–éƒ¨ã€‚

æ•è·ç»„æœ‰ä¸¤ç§å½¢å¼ï¼Œä¸€ç§æ˜¯æ™®é€šæ•è·ç»„ï¼Œå¦ä¸€ç§æ˜¯å‘½åæ•è·ç»„ã€‚

```javascript
const regex = /(\d{4})-(\d{2})-(\d{2})/
const matchers = regex.exec('2018-07-02')
matchers[0]    // 2018-07-02
matchers[1]    // 2018
matchers[2]    // 07
matchers[3]    // 02
```

ä½¿ç”¨æ•°å­—æ•è·ç»„çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯å¯¹äºå¼•ç”¨ä¸å¤ªç›´è§‚ï¼Œä»¥ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¾ˆéš¾åˆ†æ¸…æ¥šå“ªä¸ªç»„ä»£è¡¨çš„æ˜¯å¹´ï¼Œå“ªä¸ªç»„ä»£è¡¨çš„æ˜¯æœˆã€‚è€Œå‘½åæ•è·ç»„å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

### å‘½åæ•è·ç»„

ES2018 å…è®¸å‘½åæ•è·ç»„å¯ä»¥ä½¿ç”¨ `(?<name>...)` è¯­æ³•ç»™æ¯ä¸ªç»„èµ·ä¸€ä¸ªåå­—ã€‚

```javascript
const regex = /(?<year>[0-9]{4})-(?<month>[0-9]{2})-(?<day>[0-9]{2})/
const match = regex.exec('2018-07-02')
console.log(match.groups.day) // '02'
console.log(match.groups.month) // '07'
console.log(match.groups.year) // '2018'
```

### åå­—å”¯ä¸€

æ¯ä¸ªæ•è·ç»„çš„åå­—å¿…é¡»å”¯ä¸€ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

```javascript
const regex = /(?<foo>\d)-(?<foo>\d)/
// Uncaught SyntaxError: Invalid regular expression: /(?<foo>\d)-(?<foo>\d)/: Duplicate capture group name
```

### åŒ¹é…å¤±è´¥

ä»»ä½•åŒ¹é…å¤±è´¥çš„å‘½åç»„éƒ½å°†è¿”å› undefinedã€‚

```javascript
let re = /^(?<optional>\d+)?$/
const matchers = re.exec('')

matchers[0] === ''
matchers.groups.optional === undefined
```

### ä½¿ç”¨ç»“æ„èµ‹å€¼

```javascript
let re = /^(?<one>.*):(?<two>.*)$/
let {groups: {one, two}} = re.exec('foo:bar')
console.log(`one: ${one}, two: ${two}`)  // è¾“å‡º one: foo, two: bar
```

### ä½¿ç”¨ replace

```javascript
const reDate = /(?<year>[0-9]{4})-(?<month>[0-9]{2})-(?<day>[0-9]{2})/
const d = '2018-07-02'
console.log(d.replace(reDate, '$<month>-$<day>-$<year>')) // 07-02-2018
```

`String.prototype.replace` ç¬¬ 2 ä¸ªå‚æ•°å¯ä»¥æ¥å—ä¸€ä¸ªå‡½æ•°ã€‚è¿™æ—¶ å‘½åæ•è·ç»„çš„å¼•ç”¨ä¼šä½œä¸º groups å‚æ•°ä¼ é€’è¿›å»:

```javascript
let re = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/

let result = '2018-07-02'.replace(re, (...args) => {
  let {day, month, year} = args[args.length - 1]
  return `${day}-${month}-${year}`
})

result === '02/07/2018' // true
```

### åå‘å¼•ç”¨

å½“éœ€è¦åœ¨æ­£åˆ™è¡¨è¾¾å¼é‡Œé¢å¼•ç”¨å‘½åæ•è·ç»„æ—¶ï¼Œä½¿ç”¨ `\k<name>` è¯­æ³•ã€‚

```javascript
let duplicate = /^(?<half>.*).\k<half>$/
duplicate.test('a*b') // false
duplicate.test('a*a') // true
```	

### å‘ä¸‹å…¼å®¹

`/(?<name>)/` å’Œ `/\k<foo>/` åªæœ‰åœ¨å‘½åæ•è·ç»„ä¸­æ‰æœ‰æ„ä¹‰ã€‚å¦‚æœæ­£åˆ™è¡¨è¾¾å¼æ²¡æœ‰å‘½åæ•è·ç»„ï¼Œé‚£ä¹ˆ `/\k<foo>/` ä»…ä»…æ˜¯å­—ç¬¦ä¸²å­—é¢é‡ "k<foo>" è€Œå·²ã€‚

```javascript
/\k<foo>/.test('k<foo>')   // true
```

## [æ­£åˆ™è¡¨è¾¾å¼åå‘(lookbehind)æ–­è¨€](https://github.com/tc39/proposal-regexp-lookbehind)

æ–­è¨€ (Assertion) æ˜¯ä¸€ä¸ªå¯¹å½“å‰åŒ¹é…ä½ç½®ä¹‹å‰æˆ–ä¹‹åçš„å­—ç¬¦çš„æµ‹è¯•ï¼Œå®ƒä¸ä¼šå®é™…æ¶ˆè€—ä»»ä½•å­—ç¬¦ï¼Œæ‰€ä»¥æ–­è¨€ä¹Ÿè¢«ç§°ä¸ºâ€œéæ¶ˆè€—æ€§åŒ¹é…â€æˆ–â€œéè·å–åŒ¹é…â€ã€‚

æ­£åˆ™è¡¨è¾¾å¼çš„æ–­è¨€ä¸€å…±æœ‰ 4 ç§å½¢å¼ï¼š

- `(?=pattern)` é›¶å®½æ­£å‘è‚¯å®šæ–­è¨€(zero-width positive lookahead assertion)
- `(?!pattern)` é›¶å®½æ­£å‘å¦å®šæ–­è¨€(zero-width negative lookahead assertion)
- `(?<=pattern)` é›¶å®½åå‘è‚¯å®šæ–­è¨€(zero-width positive lookbehind assertion)
- `(?<!pattern)` é›¶å®½åå‘å¦å®šæ–­è¨€(zero-width negative lookbehind assertion)

### æ­£å‘æ–­è¨€(lookahead)

å½“å‰ä½ç½®åé¢çš„å­—ç¬¦ä¸²åº”è¯¥æ»¡è¶³æ–­è¨€ï¼Œä½†æ˜¯å¹¶ä¸æ•è·ï¼Œåœ¨å½“å‰çš„ JavaScript æ­£åˆ™è¡¨è¾¾å¼åªæ”¯æŒæ­£å‘æ–­è¨€ã€‚

```javascript
const regex = /li(?=zhen)/
const match1 = regex.exec('lizhen')
console.log(match1[0]) // li
// å¦‚æœå­—ç¬¦ä¸²æ²¡æœ‰zhenï¼Œåˆ™æ— æ³•åŒ¹é…
const match2 = regex.exec('liming')
console.log(match2) // null
```

æ­£å‘å¦å®šæ–­è¨€æ­£å¥½ç›¸å

```javascript
const regex = /li(?!zhen)/

const match1 = regex.exec('lizhen')
console.log(match1)    // null

const match2 = regex.exec('liming')
console.log(match2[0]) // li
```

### åå‘æ–­è¨€(lookbehind)

åå‘æ–­è¨€å’Œæ­£å‘æ–­è¨€çš„è¡Œä¸ºä¸€æ ·ï¼Œåªæ˜¯æ–¹å‘ç›¸åã€‚åå‘è‚¯å®šæ–­è¨€ä½¿ç”¨è¯­æ³• `(?<=...)`ã€‚

æ¯”å¦‚æˆ‘ä»¬æƒ³è·å–æ‰€æœ‰çš„äººæ°‘å¸é‡‘é¢ï¼Œä½†æ˜¯ä¸è·å–å…¶å®ƒè´§å¸ï¼ˆæ¯”å¦‚ç¾å…ƒï¼‰ï¼š

```javascript
const regex = /(?<=\D)\d+(\.\d*)?/
const match = regex.exec('$123.89')
console.log(match[0]) // 123.89
```

## [æ­£åˆ™è¡¨è¾¾å¼ Unicode è½¬ä¹‰](https://github.com/tc39/proposal-regexp-unicode-property-escapes)




## å‚è€ƒæ–‡æ¡£

- [esnext](http://esnext.justjavac.com/proposal/)
- [[è¯‘] ES2018ï¼ˆES9ï¼‰çš„æ–°ç‰¹æ€§](https://juejin.im/post/5b2a186cf265da596d04a648)