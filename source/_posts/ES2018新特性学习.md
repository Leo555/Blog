---
title: ES2018æ–°ç‰¹æ€§å­¦ä¹ 
date: 2018-07-02 19:47:59
categories: JavaScript
tags:
- ES2018
- ES9
---

ECMAScript 2018 (ES9) åœ¨ 6 æœˆåº•æ­£å¼å‘å¸ƒï¼Œå¸¦æ¥äº†å¾ˆå¤šæ–°ç‰¹æ€§ã€‚å…³äº ES7 å’Œ ES8 ç›¸å…³çš„çŸ¥è¯†ï¼Œå¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç«  [ES2016 å’Œ ES2017 å­¦ä¹ ](https://lz5z.com/ES2016%E5%92%8CES2017%E5%AD%A6%E4%B9%A0/)ã€‚ç›®å‰å¤§éƒ¨åˆ† ES7 å’Œ ES8 çš„ç‰¹æ€§éƒ½å¾—åˆ°ä¸»æµæµè§ˆå™¨çš„æ”¯æŒï¼Œè€Œ ES9 çš„æ–°ç‰¹æ€§è¿˜æœªèƒ½å®ç°å¾ˆå¥½çš„å…¼å®¹æ€§ã€‚

å…³äº ES7/8/9 å…¨éƒ¨ç‰¹æ€§å¯ä»¥æŸ¥çœ‹ tc39 å®˜æ–¹çš„ [proposals](https://github.com/tc39/proposals/blob/master/finished-proposals.md)ï¼Œè¿™äº›éƒ½æ˜¯æœ€åè¿›å…¥ stage 4 çš„ç‰¹æ€§ã€‚

ES9 çš„æ–°ç‰¹æ€§ï¼š

1. Lifting template literal restriction æ¨¡æ¿è¯­æ³•ä¿®æ­£
2. `s` (dotAll) flag for regular expressions (æ­£åˆ™è¡¨è¾¾å¼ dotAll æ¨¡å¼)
3. RegExp named capture groups (æ­£åˆ™è¡¨è¾¾å¼å‘½åæ•è·ç»„)
4. Rest/Spread Properties (Rest/Spread å±æ€§)
5. RegExp Lookbehind Assertions (æ­£åˆ™è¡¨è¾¾å¼åå‘(lookbehind)æ–­è¨€)
6. RegExp Unicode Property Escapes (æ­£åˆ™è¡¨è¾¾å¼ Unicode è½¬ä¹‰)
7. Promise.prototype.finally
8. Asynchronous Iteration (å¼‚æ­¥è¿­ä»£å™¨)

<!--more-->

## [æ­£åˆ™è¡¨è¾¾å¼ dotAll æ¨¡å¼](https://github.com/tc39/proposal-regexp-dotall-flag)

dotAll æ˜¯ä¸€ä¸ªæ–°çš„æ­£åˆ™è¡¨è¾¾å¼ä¿®é¥°ç¬¦ï¼Œç›®å‰ JS æ‹¥æœ‰çš„ä¿®é¥°ç¬¦æœ‰ï¼š

- g -> global
- i -> ingoreCase
- m -> multiline
- y -> sticky
- u -> unicode
- s -> dotAll

æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„ `.` ç”¨æ¥åŒ¹é…ä»»ä½•å•ä¸ªå­—ç¬¦ï¼Œä½†æ˜¯æœ‰ 2 ä¸ªé™¤å¤–ï¼šå¤šå­—èŠ‚ emoji å­—ç¬¦å’Œè¡Œç»ˆç»“ç¬¦ã€‚

```javascript
let regex = /^.$/
regex.test('ğŸ˜€')   // false
```

é€šè¿‡è®¾ç½® u è¡¨ç¤º unicode

```javascript
let regex = /^.$/u
regex.test('ğŸ˜€')   // true
```

è¡Œç»ˆæ­¢ç¬¦åŒ…æ‹¬

- U+000A LINE FEED (LF) (\n) - æ¢è¡Œ
- U+000D CARRIAGE RETURN (CR) (\r) - å›è½¦
- U+2028 LINE SEPARATOR - è¡Œåˆ†éš”ç¬¦
- U+2029 PARAGRAPH SEPARATOR - æ®µåˆ†éš”ç¬¦

è¿˜æœ‰ä¸€äº›å…¶å®ƒå­—ç¬¦ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€è¡Œçš„å¼€å§‹ï¼š

- U+000B VERTICAL TAB (\v)
- U+000C FORM FEED (\f)
- U+0085 NEXT LINE

ç›®å‰ `.` åªèƒ½åŒ¹é…å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼š

```javascript
let regex = /./

regex.test('\n')       // false
regex.test('\r')       // false
regex.test('\u{2028}') // false
regex.test('\u{2029}') // false

regex.test('\v')       // true
regex.test('\f')       // true
regex.test('\u{0085}') // true
```

æ ‡è®° `s` è¡¨ç¤º dotAllï¼Œç”¨æ¥æ”¹å˜ `.` ä¸èƒ½åŒ¹é…è¡Œç»ˆæ­¢ç¬¦çš„è¡Œä¸º:

```javascript
/hello.world/.test('hello\nworld')  // false
/hello.world/s.test('hello\nworld') // true
```

æˆ–è€…ç”¨ `\s` æ¥åŒ¹é…ç©ºç™½ç¬¦ï¼š

```javascript
/hello.world/.test('hello\nworld')  // false
/hello[\s]world/s.test('hello\nworld') // true
```

dotAll è¡¨ç¤º `.` å¯ä»¥åŒ¹é…ä»»æ„å­—ç¬¦ï¼š

```javascript
const re = /hello.world/s  // ç­‰ä»·äº const re = new RegExp('hello.world', 's')

re.test('hello\nworld') // true
re.dotAll // true
re.flags // 's'
```

## [æ­£åˆ™è¡¨è¾¾å¼å‘½åæ•è·ç»„](https://github.com/tc39/proposal-regexp-named-groups)

æ•è·ç»„å°±æ˜¯æŠŠæ­£åˆ™è¡¨è¾¾å¼ä¸­åŒ¹é…åˆ°çš„å†…å®¹ï¼Œä¿å­˜åˆ°å†…å­˜ä¸­ä»¥æ•°å­—ç¼–å·æˆ–è€…æ˜¾å¼å‘½åçš„æ•°ç»„é‡Œï¼Œæ–¹ä¾¿åé¢ä½¿ç”¨ã€‚è¿™ç§å¼•ç”¨æ—¢å¯ä»¥åœ¨æ­£åˆ™è¡¨è¾¾å¼å†…éƒ¨ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨æ­£åˆ™è¡¨è¾¾å¼å¤–éƒ¨ã€‚

æ•è·ç»„æœ‰ä¸¤ç§å½¢å¼ï¼Œä¸€ç§æ˜¯æ™®é€šæ•è·ç»„ï¼Œå¦ä¸€ç§æ˜¯å‘½åæ•è·ç»„ã€‚

```javascript
const regex = /(\d{4})-(\d{2})-(\d{2})/
const matchers = regex.exec('2018-07-02')
matchers[0]    // 2018-07-02
matchers[1]    // 2018
matchers[2]    // 07
matchers[3]    // 02
```

ä½¿ç”¨æ•°å­—æ•è·ç»„çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯å¯¹äºå¼•ç”¨ä¸å¤ªç›´è§‚ï¼Œä»¥ä¸Šé¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬å¾ˆéš¾åˆ†æ¸…æ¥šå“ªä¸ªç»„ä»£è¡¨çš„æ˜¯å¹´ï¼Œå“ªä¸ªç»„ä»£è¡¨çš„æ˜¯æœˆã€‚è€Œå‘½åæ•è·ç»„å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

### å‘½åæ•è·ç»„

ES2018 å…è®¸å‘½åæ•è·ç»„å¯ä»¥ä½¿ç”¨ `(?<name>...)` è¯­æ³•ç»™æ¯ä¸ªç»„èµ·ä¸€ä¸ªåå­—ã€‚

```javascript
const regex = /(?<year>[0-9]{4})-(?<month>[0-9]{2})-(?<day>[0-9]{2})/
const match = regex.exec('2018-07-02')
console.log(match.groups.day) // '02'
console.log(match.groups.month) // '07'
console.log(match.groups.year) // '2018'
```

### åå­—å”¯ä¸€

æ¯ä¸ªæ•è·ç»„çš„åå­—å¿…é¡»å”¯ä¸€ï¼Œå¦åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚

```javascript
const regex = /(?<foo>\d)-(?<foo>\d)/
// Uncaught SyntaxError: Invalid regular expression: /(?<foo>\d)-(?<foo>\d)/: Duplicate capture group name
```

### åŒ¹é…å¤±è´¥

ä»»ä½•åŒ¹é…å¤±è´¥çš„å‘½åç»„éƒ½å°†è¿”å› undefinedã€‚

```javascript
let re = /^(?<optional>\d+)?$/
const matchers = re.exec('')

matchers[0] === ''
matchers.groups.optional === undefined
```

### ä½¿ç”¨ç»“æ„èµ‹å€¼

```javascript
let re = /^(?<one>.*):(?<two>.*)$/
let {groups: {one, two}} = re.exec('foo:bar')
console.log(`one: ${one}, two: ${two}`)  // è¾“å‡º one: foo, two: bar
```

### ä½¿ç”¨ replace

```javascript
const reDate = /(?<year>[0-9]{4})-(?<month>[0-9]{2})-(?<day>[0-9]{2})/
const d = '2018-07-02'
console.log(d.replace(reDate, '$<month>-$<day>-$<year>')) // 07-02-2018
```

`String.prototype.replace` ç¬¬ 2 ä¸ªå‚æ•°å¯ä»¥æ¥å—ä¸€ä¸ªå‡½æ•°ã€‚è¿™æ—¶ å‘½åæ•è·ç»„çš„å¼•ç”¨ä¼šä½œä¸º groups å‚æ•°ä¼ é€’è¿›å»:

```javascript
let re = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/

let result = '2018-07-02'.replace(re, (...args) => {
  let {day, month, year} = args[args.length - 1]
  return `${day}-${month}-${year}`
})

result === '02/07/2018' // true
```

### åå‘å¼•ç”¨

å½“éœ€è¦åœ¨æ­£åˆ™è¡¨è¾¾å¼é‡Œé¢å¼•ç”¨å‘½åæ•è·ç»„æ—¶ï¼Œä½¿ç”¨ `\k<name>` è¯­æ³•ã€‚

```javascript
let duplicate = /^(?<half>.*).\k<half>$/
duplicate.test('a*b') // false
duplicate.test('a*a') // true
```	

### å‘ä¸‹å…¼å®¹

`/(?<name>)/` å’Œ `/\k<foo>/` åªæœ‰åœ¨å‘½åæ•è·ç»„ä¸­æ‰æœ‰æ„ä¹‰ã€‚å¦‚æœæ­£åˆ™è¡¨è¾¾å¼æ²¡æœ‰å‘½åæ•è·ç»„ï¼Œé‚£ä¹ˆ `/\k<foo>/` ä»…ä»…æ˜¯å­—ç¬¦ä¸²å­—é¢é‡ "k<foo>" è€Œå·²ã€‚

```javascript
/\k<foo>/.test('k<foo>')   // true
```

## [æ­£åˆ™è¡¨è¾¾å¼åå‘(lookbehind)æ–­è¨€](https://github.com/tc39/proposal-regexp-lookbehind)

æ–­è¨€ (Assertion) æ˜¯ä¸€ä¸ªå¯¹å½“å‰åŒ¹é…ä½ç½®ä¹‹å‰æˆ–ä¹‹åçš„å­—ç¬¦çš„æµ‹è¯•ï¼Œå®ƒä¸ä¼šå®é™…æ¶ˆè€—ä»»ä½•å­—ç¬¦ï¼Œæ‰€ä»¥æ–­è¨€ä¹Ÿè¢«ç§°ä¸ºâ€œéæ¶ˆè€—æ€§åŒ¹é…â€æˆ–â€œéè·å–åŒ¹é…â€ã€‚

æ­£åˆ™è¡¨è¾¾å¼çš„æ–­è¨€ä¸€å…±æœ‰ 4 ç§å½¢å¼ï¼š

- `(?=pattern)` é›¶å®½æ­£å‘è‚¯å®šæ–­è¨€(zero-width positive lookahead assertion)
- `(?!pattern)` é›¶å®½æ­£å‘å¦å®šæ–­è¨€(zero-width negative lookahead assertion)
- `(?<=pattern)` é›¶å®½åå‘è‚¯å®šæ–­è¨€(zero-width positive lookbehind assertion)
- `(?<!pattern)` é›¶å®½åå‘å¦å®šæ–­è¨€(zero-width negative lookbehind assertion)

### æ­£å‘æ–­è¨€(lookahead)

å½“å‰ä½ç½®åé¢çš„å­—ç¬¦ä¸²åº”è¯¥æ»¡è¶³æ–­è¨€ï¼Œä½†æ˜¯å¹¶ä¸æ•è·ï¼Œåœ¨å½“å‰çš„ JavaScript æ­£åˆ™è¡¨è¾¾å¼åªæ”¯æŒæ­£å‘æ–­è¨€ã€‚

```javascript
const regex = /li(?=zhen)/
const match1 = regex.exec('lizhen')
console.log(match1[0]) // li
// å¦‚æœå­—ç¬¦ä¸²æ²¡æœ‰zhenï¼Œåˆ™æ— æ³•åŒ¹é…
const match2 = regex.exec('liming')
console.log(match2) // null
```

æ­£å‘å¦å®šæ–­è¨€æ­£å¥½ç›¸å

```javascript
const regex = /li(?!zhen)/

const match1 = regex.exec('lizhen')
console.log(match1)    // null

const match2 = regex.exec('liming')
console.log(match2[0]) // li
```

### åå‘æ–­è¨€(lookbehind)

åå‘æ–­è¨€å’Œæ­£å‘æ–­è¨€çš„è¡Œä¸ºä¸€æ ·ï¼Œåªæ˜¯æ–¹å‘ç›¸åã€‚åå‘è‚¯å®šæ–­è¨€ä½¿ç”¨è¯­æ³• `(?<=...)`ã€‚

æ¯”å¦‚æˆ‘ä»¬æƒ³è·å–æ‰€æœ‰çš„äººæ°‘å¸é‡‘é¢ï¼Œä½†æ˜¯ä¸è·å–å…¶å®ƒè´§å¸ï¼ˆæ¯”å¦‚ç¾å…ƒï¼‰ï¼š

```javascript
const regex = /(?<=\D)\d+(\.\d*)?/
const match = regex.exec('$123.89')
console.log(match[0]) // 123.89
```

## [æ­£åˆ™è¡¨è¾¾å¼ Unicode è½¬ä¹‰](https://github.com/tc39/proposal-regexp-unicode-property-escapes)

Unicode æ ‡å‡†ä¸ºæ¯ä¸ªç¬¦å·åˆ†é…å„ç§å±æ€§å’Œå±æ€§å€¼ï¼Œæ¯”å¦‚å¸Œè…Šå­—æ¯ `Ï€` åœ¨ Unicode ä¸­æœ‰ç‹¬ç‰¹çš„å±æ€§å’Œå±æ€§å€¼ã€‚ç›®å‰ç‰ˆæœ¬çš„ ECMAScript ä¸­æ­£åˆ™è¡¨è¾¾å¼æ˜¯æ— æ³•åŒ¹é…è¿™äº› Unicode çš„ï¼Œé€šå¸¸å¼€å‘äººå‘˜æœ‰ä¸¤ç§é€‰æ‹©ã€‚

(1) åœ¨è¿è¡Œæ—¶ä½¿ç”¨ç±»ä¼¼äº [xregexp](https://github.com/slevithan/xregexp) è¿™æ ·çš„åº“åˆ›å»ºå¢å¼ºçš„æ­£åˆ™è¡¨è¾¾å¼ï¼š

```javascript
const regexGreekSymbol = XRegExp('\\p{Greek}', 'A')
regexGreekSymbol.test('Ï€') // true
```

ç¼ºç‚¹æ˜¯ xregexp æ˜¯ä¸€ä¸ªè¿è¡Œæ—¶ä¾èµ–ï¼Œå¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„ web åº”ç”¨æ¥è¯´ä¸æ˜¯å¾ˆç†æƒ³ã€‚è€Œä¸”å…¶å‹ç¼©æ–‡ä»¶ `xregexp-all-min.js.gz` ä¹Ÿæœ‰ 35kï¼Œå¹¶ä¸”æ¯å½“ Unicode æ ‡å‡†æ›´æ–°æ—¶ï¼Œå¿…é¡»è¦æ›´æ–° xregexp æ‰èƒ½ä½¿ç”¨æ–°æ•°æ®ã€‚

(2) åœ¨ç¼–è¯‘æ—¶çš„æ—¶å€™ä½¿ç”¨ [regenerate](https://github.com/mathiasbynens/regenerate) ç”Ÿæˆæ­£åˆ™è¡¨è¾¾å¼ã€‚

```javascript
const regenerate = require('regenerate')
const codePoints = require('unicode-9.0.0/Script/Greek/code-points.js')
const set = regenerate(codePoints)
set.toString()
// â†’ '[\u0370-\u0373\u0375-\u0377\u037A-\u037D\u037F\u0384\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03E1\u03F0-\u03FF\u1D26-\u1D2A\u1D5D-\u1D61\u1D66-\u1D6A\u1DBF\u1F00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FC4\u1FC6-\u1FD3\u1FD6-\u1FDB\u1FDD-\u1FEF\u1FF2-\u1FF4\u1FF6-\u1FFE\u2126\uAB65]|\uD800[\uDD40-\uDD8E\uDDA0]|\uD834[\uDE00-\uDE45]'
// Imagine thereâ€™s more code here to save this pattern to a file.
```

è™½ç„¶è¿™ç§æ–¹æ³•æ‰€ç”Ÿæˆçš„æ­£åˆ™è¡¨è¾¾å¼ç›¸å½“å¤§ï¼Œä½†æ˜¯èƒ½å¤Ÿå¾—åˆ°æœ€ä½³çš„è¿è¡Œæ—¶æ€§èƒ½ã€‚æœ€å¤§çš„ç¼ºç‚¹æ˜¯å®ƒéœ€è¦ä¸€ä¸ªæ„å»ºè„šæœ¬ï¼Œæ¯å½“ Unicode æ ‡å‡†æ›´æ–°æ—¶ï¼Œå¿…é¡»æ›´æ–°ç”Ÿæˆè„šæœ¬ã€‚

### è§£å†³æ–¹æ¡ˆ

ES2018 ä¸­ä½¿ç”¨ `\p{â€¦}` å’Œ `\P{â€¦}` è¿›è¡Œ Unicode çš„å±æ€§è½¬ä¹‰ï¼Œåœ¨æ­£åˆ™è¡¨è¾¾å¼ä¸­ä½¿ç”¨ `u` è¿›è¡Œæ ‡è®°ã€‚åœ¨ `\p{â€¦}` å†…ï¼Œå¯ä»¥ä»¥é”®å€¼å¯¹çš„æ–¹å¼è®¾ç½®éœ€è¦åŒ¹é…çš„å±æ€§ï¼Œè€Œéå…·ä½“å†…å®¹ã€‚æ¯”å¦‚è¦åŒ¹é…å¸Œè…Šå­—æ¯ `Ï€`ï¼š

```javascript
const reGreekSymbol = /\p{Script=Greek}/u
reGreekSymbol.test('Ï€') // true
```

è§£å†³äº†ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š

1. ä¸ç”¨ä¸ºåˆ›å»º Unicode-aware æ­£åˆ™è¡¨è¾¾å¼æ‹…å¿ƒã€‚
2. ä¸éœ€è¦è¿è¡Œæ—¶ä¾èµ–ã€‚
3. æ­£åˆ™è¡¨è¾¾å¼ä¸éœ€è¦ä½¿ç”¨ Unicode åŒºé—´æ¥åˆ¤æ–­ç‰¹ç‚¹çš„å†…å®¹ã€‚
4. ä¸éœ€è¦ç”Ÿæˆæ­£åˆ™è¡¨è¾¾å¼è„šæœ¬ã€‚
5. Unicode å±æ€§è½¬ä¹‰è‡ªåŠ¨ä¿æŒæœ€æ–°ï¼Œæ¯å½“ Unicode æ ‡å‡†æ›´æ–°æ—¶ï¼ŒECMAScript å¼•æ“æ›´æ–°å…¶æ•°æ®å³å¯ã€‚


## [Rest/Spread å±æ€§](https://github.com/tc39/proposal-object-rest-spread)

ECMAScript 6 ä¸­å¢åŠ äº†æ•°ç»„çš„ Rest è§£æ„èµ‹å€¼å’Œ Spread è¯­æ³•ï¼Œæ¯”å¦‚ï¼š

```javascript
var a, b, rest
[a, b, ...rest] = [10, 20, 30, 40, 50]
console.log(a) // 10
console.log(b) // 20
console.log(rest) // [30, 40, 50]
```

```javascript
function sum(x, y, z) {
  return x + y + z
}
const numbers = [1, 2, 3]
sum(...numbers) // 6
sum.apply(null, numbers) // 6
```

ES2018 ä¸­å¢åŠ äº†å¯¹è±¡çš„ Rest å±æ€§å’Œ Spread è¯­æ³•ã€‚

### Rest å±æ€§

```javascript
let {x, y, ...z} = {x:1, y:2, a:3, b:4}
x // 1
y // 2
z // {a:3, b: 4}
```

### Spread è¯­æ³•

```javascript
let n = {x, y, ...z}
n // {x:1, y:2, a:3, b:4}
```


## [Promise.prototype.finally](https://github.com/tc39/proposal-promise-finally)

Promise.prototype.finally æ—©å°±æœ‰å¾ˆå¤šå®ç°ï¼Œä»¥è‡³äºæˆ‘ä¸€ç›´éƒ½è®¤ä¸ºå®ƒæ˜¯åŸç”Ÿå¯¹è±¡çš„åŸå‹å±æ€§ã€‚å¸¸è§çš„å®ç°æœ‰ï¼š

1. [Bluebird#finally](http://bluebirdjs.com/docs/api/finally.html)
2. [Q#finally](https://github.com/kriskowal/q/wiki/API-Reference#promisefinallycallback)
3. [when#finally](https://github.com/cujojs/when/blob/master/docs/api.md#promisefinally)
4. [jQuery jqXHR#always](http://api.jquery.com/jQuery.ajax/#jqXHR)

```javascript
Promise.resolve(2).finally(() => {}) // will be resolved with 2

Promise.reject(3).finally(() => {}) // will be rejected with 3
```

## [Asynchronous Iteration](https://github.com/tc39/proposal-async-iteration)

å…³äº JavaScript çš„å¼‚æ­¥å¾ªç¯ï¼Œæˆ‘åœ¨ä¹‹å‰çš„æ–‡ç« [JavaScript å¾ªç¯ä¸å¼‚æ­¥](https://lz5z.com/JavaScript-Loop-Async/)æœ‰è¿‡æ¢ç´¢ã€‚å¦‚ä»Š ECMAScript ä¸­æœ‰äº†å¯¹å¼‚æ­¥è¿­ä»£çš„åŸç”Ÿæ”¯æŒã€‚

### è¿­ä»£å™¨ Iterator

ES6 ä¸­å¼•å…¥è¿­ä»£å™¨æ¥éå†æ•°ç»„ï¼ŒJavaScript ä¸­çš„è¿­ä»£å™¨æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæä¾› next() æ–¹æ³•ï¼Œç”¨æ¥è¿”å›åºåˆ—ä¸­çš„ä¸‹ä¸€é¡¹ï¼Œè¿™ä¸ªæ–¹æ³•åŒ…å«ä¸¤ä¸ªå±æ€§ï¼šdone å’Œ valueã€‚

è¿­ä»£å™¨å¯¹è±¡ä¸€æ—¦è¢«åˆ›å»ºï¼Œå°±å¯ä»¥åå¤è°ƒç”¨ next()ã€‚

```javascript
function makeIterator (array) {
  var nextIndex = 0
  return {
    next: function () {
      return nextIndex < array.length ?
        {value: array[nextIndex++], done: false} :
        {done: true}
    }
  }
}
// åˆå§‹åŒ–å next() æ–¹æ³•å¯ä»¥ç”¨æ¥ä¾æ¬¡è®¿é—®å¯¹è±¡ä¸­çš„é”®å€¼
var it = makeIterator(['a', 'b'])
console.log(it.next().value) // 'a'
console.log(it.next().value) // 'b'
console.log(it.next().done)  // true
```

### å¯è¿­ä»£å¯¹è±¡

å¸¸è§çš„å¯è¿­ä»£å¯¹è±¡æœ‰ï¼šArrayã€Stringã€TypedArrayã€Mapã€Setã€‚è¿™äº›å¯¹è±¡éƒ½å†…ç½®å¯è¿­ä»£çš„å¯¹è±¡ï¼Œåœ¨å…¶åŸå‹ä¸­æœ‰ä¸€ä¸ª `Symbol.iterator` æ–¹æ³•ã€‚

æˆ‘ä»¬ä¹Ÿå¯ä»¥å®šä¹‰å¯è¿­ä»£å¯¹è±¡ã€‚

```javascript
var myIterable = {}
myIterable[Symbol.iterator] = function* () {
  yield 1
  yield 2
  yield 3
}

for (let value of myIterable) { 
  console.log(value)
}
// 1
// 2
// 3

var [a, b, c] = [...myIterable] // [1, 2, 3]
// a ===1; b === 2; c === 3
Array.from(myIterable) // [1, 2, 3]
```

å½“æˆ‘ä»¬å®šä¹‰äº†å¯è¿­ä»£å¯¹è±¡åï¼Œå°±å¯ä»¥åœ¨ `Array.from`ã€`for...of` ä¸­ä½¿ç”¨è¿™ä¸ªå¯¹è±¡ã€‚

### å¼‚æ­¥è¿­ä»£å™¨

ä¸€ä¸ªå¼‚æ­¥è¿­ä»£å™¨å°±åƒä¸€ä¸ªè¿­ä»£å™¨ï¼Œé™¤äº†å®ƒçš„ next() æ–¹æ³•è¿”å›ä¸€ä¸ª { value, done } çš„ promiseã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬å¿…é¡»è¿”å›è¿­ä»£å™¨ç»“æœçš„ promiseï¼Œå› ä¸ºåœ¨è¿­ä»£å™¨æ–¹æ³•è¿”å›æ—¶ï¼Œè¿­ä»£å™¨çš„ä¸‹ä¸€ä¸ªå€¼å’Œ done çŠ¶æ€å¯èƒ½æœªçŸ¥ã€‚

```javascript
const myAsyncIterator = {
  [Symbol.asyncIterator]: () => {
  	const items = ['a', 'b', 'c', 'd']
  	return {
  	  next: () => Promise.resolve({
        done: items.length === 0,
        value, items.shift()
  	  })
  	}
  }
}
```

å¯¹äºå¼‚æ­¥è¿­ä»£å™¨ï¼Œä½¿ç”¨ `for await of` è¿›è¡Œè¿­ä»£ã€‚

```javascript
(async function () {
  for await (const item of myAsyncIterator) {
    console.log(item)
  }
})()
```


## å‚è€ƒæ–‡æ¡£

- [esnext](http://esnext.justjavac.com/proposal/)
- [[è¯‘] ES2018ï¼ˆES9ï¼‰çš„æ–°ç‰¹æ€§](https://juejin.im/post/5b2a186cf265da596d04a648)